# 課題A

getpid(2)をn=1, 10000回実行するのにかかる時間が知りたい。

まず、`A2.c`のように、単純に`getpid()`をループで複数回呼び出すサンプルを作った。コンパイラの最適化による高速化を防ぐために、`gcc A2.c -O0`として最適化をせずにコンパイルした。

実行結果は、1回が5us, 10000回が70us。しかし回数にくらべ実行時間が増えていない。straceを使って、何回システムコールされたかを調べた。
`strace -c ./a.out`
そのけっかは、
```
15
34
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 34.62    0.000018           2         8           mmap
 21.15    0.000011           3         4           mprotect
 11.54    0.000006           3         2           write
  9.62    0.000005           5         1           munmap
  9.62    0.000005           2         3         3 access
  7.69    0.000004           2         2           open
  1.92    0.000001           1         1           read
  1.92    0.000001           1         2           close
  1.92    0.000001           0         3           fstat
  0.00    0.000000           0         1           brk
  0.00    0.000000           0         1           getpid
  0.00    0.000000           0         1           execve
  0.00    0.000000           0         1           arch_prctl
------ ----------- ----------- --------- --------- ----------------
100.00    0.000052                    30         3 total
```

となっていた。これをみるとgetpidは一回しか呼ばれておらず、一回呼ばれてpidがわかったあとはキャッシュされている値を返しているだけであることが推測される。

そのため、syscall()を使ってgetpidのシステムコールを間接的に呼び出すプログラム`A3.c`を作成し、同様の実験を行った。
すると実行結果は順に2us 4868usとなり、straceの結果も、
```
14
201891
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 99.05    0.011446           1     10001           getpid
  0.23    0.000027           3         8           mmap
  0.20    0.000023          12         2           write
  0.16    0.000019           5         4           mprotect
  0.09    0.000010           3         3         3 access
  0.08    0.000009           5         2           open
  0.07    0.000008           8         1           munmap
  0.04    0.000005           2         3           fstat
  0.03    0.000003           2         2           close
  0.02    0.000002           2         1           read
  0.02    0.000002           2         1           execve
  0.01    0.000001           1         1           brk
  0.01    0.000001           1         1           arch_prctl
------ ----------- ----------- --------- --------- ----------------
100.00    0.011556                 10030         3 total
```

となっており、getpidが10001回呼び出されていることがわかる。
したがって、システムコール呼び出しにかかる時間は2~5us/1callであるが、キャッシュすることによってコールの回数を減らしていることがわかる。
